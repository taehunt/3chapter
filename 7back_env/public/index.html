<h2>ํ์๊ฐ์</h2>
<form id="signupForm">
  <input type="text" id="signupUsername" placeholder="์์ด๋" required />
  <input type="password" id="signupPassword" placeholder="๋น๋ฐ๋ฒํธ" required />
  <button type="submit">ํ์๊ฐ์</button>
</form>

<h2>๋ก๊ทธ์ธ</h2>
<form id="loginForm">
  <input type="text" id="loginUsername" placeholder="์์ด๋" required />
  <input type="password" id="loginPassword" placeholder="๋น๋ฐ๋ฒํธ" required />
  <button type="submit">๋ก๊ทธ์ธ</button>
</form>

<p id="loginMessage"></p>
<p id="status" style="display: none"></p>
<button id="logoutBtn" style="display: none">๋ก๊ทธ์์</button>

<script>
  const loginMessage = document.getElementById("loginMessage");
  const status = document.getElementById("status");
  const logoutBtn = document.getElementById("logoutBtn");

  // UI ์๋ฐ์ดํธ ํจ์
  function updateUI() {
    const username = localStorage.getItem("username");

    if (username) {
      loginMessage.textContent = "";
      status.style.display = "block";
      status.textContent = `${username}๋ ํ์ํฉ๋๋ค! ๐`;
      logoutBtn.style.display = "inline-block";
    } else {
      status.style.display = "none";
      logoutBtn.style.display = "none";
      loginMessage.textContent = "";
    }
  }

  // ํ์๊ฐ์
  document.getElementById("signupForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const username = document.getElementById("signupUsername").value;
    const password = document.getElementById("signupPassword").value;

    const res = await fetch("/api/signup", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, password }),
    });

    const data = await res.json();
    alert(data.message);
  });

  // ๋ก๊ทธ์ธ
  document.getElementById("loginForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const username = document.getElementById("loginUsername").value;
    const password = document.getElementById("loginPassword").value;

    const res = await fetch("/api/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, password }),
    });

    const data = await res.json();
    loginMessage.textContent = data.message;

    if (res.ok) {
      localStorage.setItem("username", data.username);
      updateUI();
    }
  });

  // ๋ก๊ทธ์์
  logoutBtn.addEventListener("click", () => {
    localStorage.removeItem("username");
    status.textContent = "๋ก๊ทธ์์ ๋์์ต๋๋ค.";
    updateUI();
  });

  // ํ์ด์ง ๋ก๋ฉ ์ ๋ก๊ทธ์ธ ์ํ ํ์ธ
  window.onload = updateUI;
</script>